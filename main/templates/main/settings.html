{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" type="image/png" href="{% static 'main/favicon.ico' %}">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="{% static 'main/css/registration.css' %}">
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <a href="{% url 'you' %}"><i class='bx bx-arrow-back'></i></a>
    <svg id="visual" viewBox="0 0 1920 1080" width="1920" height="1080" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><rect x="0" y="0" width="1920" height="1080" fill="#91BFBC"></rect><defs><linearGradient id="grad1_0" x1="43.8%" y1="0%" x2="100%" y2="100%"><stop offset="14.444444444444446%" stop-color="#558987" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#558987" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad1_1" x1="43.8%" y1="0%" x2="100%" y2="100%"><stop offset="14.444444444444446%" stop-color="#558987" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#699b98" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad1_2" x1="43.8%" y1="0%" x2="100%" y2="100%"><stop offset="14.444444444444446%" stop-color="#7dadaa" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#699b98" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad1_3" x1="43.8%" y1="0%" x2="100%" y2="100%"><stop offset="14.444444444444446%" stop-color="#7dadaa" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#91bfbc" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_0" x1="0%" y1="0%" x2="56.3%" y2="100%"><stop offset="14.444444444444446%" stop-color="#558987" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#558987" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_1" x1="0%" y1="0%" x2="56.3%" y2="100%"><stop offset="14.444444444444446%" stop-color="#699b98" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#558987" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_2" x1="0%" y1="0%" x2="56.3%" y2="100%"><stop offset="14.444444444444446%" stop-color="#699b98" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#7dadaa" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_3" x1="0%" y1="0%" x2="56.3%" y2="100%"><stop offset="14.444444444444446%" stop-color="#91bfbc" stop-opacity="1"></stop><stop offset="85.55555555555554%" stop-color="#7dadaa" stop-opacity="1"></stop></linearGradient></defs><g transform="translate(1920, 0)"><path d="M0 702C-119.6 679.3 -239.2 656.7 -347 601C-454.8 545.4 -550.8 456.7 -607.9 351C-665.1 245.3 -683.6 122.7 -702 0L0 0Z" fill="#87b6b3"></path><path d="M0 526.5C-89.7 509.5 -179.4 492.5 -260.2 450.8C-341.1 409 -413.1 342.5 -456 263.3C-498.9 184 -512.7 92 -526.5 0L0 0Z" fill="#73a4a1"></path><path d="M0 351C-59.8 339.7 -119.6 328.3 -173.5 300.5C-227.4 272.7 -275.4 228.3 -304 175.5C-332.6 122.7 -341.8 61.3 -351 0L0 0Z" fill="#5f9290"></path><path d="M0 175.5C-29.9 169.8 -59.8 164.2 -86.7 150.3C-113.7 136.3 -137.7 114.2 -152 87.8C-166.3 61.3 -170.9 30.7 -175.5 0L0 0Z" fill="#558987"></path></g><g transform="translate(0, 1080)"><path d="M0 -702C112.4 -666.9 224.8 -631.7 333.5 -577.6C442.2 -523.5 547.2 -450.4 607.9 -351C668.7 -251.6 685.4 -125.8 702 0L0 0Z" fill="#87b6b3"></path><path d="M0 -526.5C84.3 -500.2 168.6 -473.8 250.1 -433.2C331.6 -392.6 410.4 -337.8 456 -263.3C501.6 -188.7 514 -94.3 526.5 0L0 0Z" fill="#73a4a1"></path><path d="M0 -351C56.2 -333.4 112.4 -315.9 166.7 -288.8C221.1 -261.8 273.6 -225.2 304 -175.5C334.4 -125.8 342.7 -62.9 351 0L0 0Z" fill="#5f9290"></path><path d="M0 -175.5C28.1 -166.7 56.2 -157.9 83.4 -144.4C110.5 -130.9 136.8 -112.6 152 -87.8C167.2 -62.9 171.3 -31.4 175.5 0L0 0Z" fill="#558987"></path></g></svg>
        <div class="registration_set">
            <span class="header_span">Настройки профиля</span>

            <div class="field" id="form_nickname">
            <form class="form_nickname" id="nickname">
                <input type="text" class="input_regestration_user" name="" id="username" value="{{ request.user.username }}">
                <input type="submit" id="user_submit" class="unput_submit_nickname" value="~">
            </form>    
            <span class="error err email-error">
                <i class="bx bx-error-circle error-icon"></i>
                <p class="error-text">Имя пользователя занято или он не соответствует требованиям</p>
            </span>
            <span class="error err2 email-error">
                <i class="bx bx-error-circle error-icon"></i>
                <p class="error-text">Имя пользователя не соответствует требованиям (Размер 3-16)</p>
            </span>
            <span class="error err3 email-error">
                <i class="bx bx-error-circle error-icon"></i>
                <p class="error-text">Заполните свой никнейм</p>
            </span>
            <span class="success succ">
                <i class="bx bx-error-circle error-icon"></i>
                <p class="error-text">Никнейм успешно изменён</p>
            </span>
            <span class="success succ1">
                <i class="bx bx-error-circle error-icon"></i>
                <p class="error-text">Никнейм свободен</p>
            </span>
            </div>
            <form class="list_settings w_1 inactive_1" id="email">
                <div class="list_settings__change a_1">
                    <span>Редактировать почту</span>
                    <i class='bx bx-right-arrow-alt bx-right-arrow-alt1' style="transform: rotate(0deg); transition: 0.3s; color: rgb(113, 112, 112);"></i>
                </div>
                <div id="oppacty1" style="transition: 0.4s; opacity: 0;">
                    <div class="input_mail input_set field-icon" id="form_mail">
                        <span>Новая почта</span>
                        <input type="text" class="input_regestration" id="const_email" value="{{ request.user.email }}">
                        <span class="error-absolute err email-error err-0">
                            <i class="bx bx-error-circle error-icon"></i>
                        </span>
                        <span data-info="Электронная почта не подходит по требованиям, примерная формуа - (onupra@gmail.com)" class="error-absolute err2 email-error err-0">
                            <i title="Электронная почта не подходит по требованиям, примерная формуа - (onupra@gmail.com)" class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Электронная почта не подходит по требованиям</p> -->
                        </span>
                        <span data-info="Введите вашу почту!" class="error-absolute err3 email-error err-0">
                            <i class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Введите вашу почту!</p> -->
                        </span>
                        <span data-info="Почта успешна изменена" class="succ-absolute succ email-error succ-0">
                            <i class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Неправильный пароль</p> -->
                        </span>
                    </div>
                    <div class="input_password_repeat field-icon input_set" id="form_mail_password">
                        <span>Введите ваш пароль</span>
                        <div class="password-relative">
                            <input type="password" class="input_regestration" id="email_password">
                            <i class='bx bx-hide show-hide'></i>
                        </div>
                        <span data-info="Пароль неверный" class="error-absolute err err-0">
                            <i class="bx bx-error-circle error-icon"></i>
                        </span>
                    </div>
                    <input type="submit" id="email_submit" class="button_submit_settings d-settings_1" value="Сохранить">
                </div>
            </form>


            <form class="list_settings w_2 inactive_2" id="password">
                <div class="list_settings__change a_2">
                    <span>Редактировать пароль</span>
                    <i class='bx bx-right-arrow-alt bx-right-arrow-alt2' style="transform: rotate(0deg);  transition: 0.2s; color: rgb(113, 112, 112);" ></i>
                </div>

                <div id="oppacty2" style="transition: 0.4s; opacity: 0;">
                    <div class="input_password_repeat input_set field-icon" id="passwordValue">
                        <span>Введите ваш пароль</span>
                        <i class='bx bx-hide show-hide'></i>
                        <input type="password" class="input_regestration" id="const_password">
                        <span data-info="Пароль неверный" class="error-absolute err email-error err-0">
                            <i class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Неправильный пароль</p> -->
                        </span>
                    </div>
                    <div class="input_password_now input_set field-icon" id="passwordValueNew">
                        <span>Введите ваш новый пароль</span>
                        <i class='bx bx-hide show-hide'></i>
                        <input type="password" class="input_regestration" id="password_new">
                        <span data-info="Пароль не подходит по требованиям (Должны использоваться цифры(0-9), Латиница заглавные и прописные(A-Za-z))" class="err-0 error-absolute err2 email-error">
                            <i  class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Пароль не подходит по требованиям</p> -->
                        </span>
                        <span data-info="Введите ваш пароль!" class="error-absolute err3 email-error err-0">
                            <i class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Введите ваш пароль!</p> -->
                        </span>
                    </div>
                    <div class="input_password_now_repeat input_set field-icon" id="CpasswordValueNew">
                        <span>Повторите ваш новый пароль</span>
                        <i class='bx bx-hide show-hide'></i>
                        <input type="password" class="input_regestration" id="Cpassword_new">
                        <span data-info="Пароли не совпадают" class="err-0 error-absolute err2 email-error">
                            <i  class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Пароли не совпадают</p> -->
                        </span>
                        <span data-info="Введите ваш пароль!" class="error-absolute err3 email-error err-0">
                            <i class="bx bx-error-circle error-icon"></i>
                            <!-- <p class="error-text">Повторите свой пароль!</p> -->
                        </span>
                    </div>
                </div>
                    <input type="submit" id="password_submit" class="button_submit_settings d-settings" value="Сохранить">
            </form>

            <div class="line"></div>

            <button class="delete_account open-popup">Удалить аккаунт</button>
        </div>

        <div class="popup__bg"> 
            <form class="popup" id="delete">
                <i class='bx bx-x close-popup'></i>

                <p></p>
                <p></p>
                <div class="input_password_repeat field" id="delete_invalid">
                    <span>Подтвердите свой пароль</span>
                    <i class='bx bx-hide show-hide'></i>
                    <input type="password" class="input_proverka input_regestration" id="delete_password">
                    <span class="error err3 email-error">
                        <i class="bx bx-error-circle error-icon"></i>
                        <p class="error-text"> Неверный пароль</p>
                    </span>
                </div>

                <button type="submit">Удалить аккаунт</button>
            </form>
        </div>
    <script src="{% static 'main/js/settings.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var initial;
function checkUsers(){
    if (true) 
    {
        form_nickname.classList.remove("invalid");
        form_nickname.classList.remove("invalid2");
        form_nickname.classList.remove("invalid3");
        form_nickname.classList.remove("successfully");
        form_nickname.classList.remove("successfully1");
        const usersPattern = /^[a-яА-Яa-zA-Z0-9!"#$%&')(*+,-./:;<=>?@^_`|]{3,20}$/;
        if (username.value === ''){
            form_nickname.classList.remove("successfully");
            form_nickname.classList.remove("invalid");
            form_nickname.classList.remove("invalid2");
            form_nickname.classList.remove("successfully1");
            return form_nickname.classList.add("invalid3"); }
        if (!username.value.match(usersPattern)){
            form_nickname.classList.remove("successfully");
            form_nickname.classList.remove("successfully1");
            form_nickname.classList.remove("invalid");
            form_nickname.classList.remove("invalid3");
            return form_nickname.classList.add("invalid2");
            } 
       
        if (true) 
        {
            function initialon(){
                initial = window.setTimeout(() => {  
             if (true) 
             
        {
            $(document).ready(function() {            
                // get name input value
                const name = $('#username').val();
                // create AJAX request
                $.ajax({
                    type: 'POST',
                    url: '',
                    headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                    },
                    data: {
                    'username': name,
                    'check_username': true
                    },
                    dataType: 'json',
                    success: function(response) {
                        const form_nickname = document.getElementById("form_nickname");
                        const username = document.getElementById("username");
                        if (response.successfully == false){
                            form_nickname.classList.remove("invalid2");
                            form_nickname.classList.remove("invalid3");
                            form_nickname.classList.remove("successfully");
                            form_nickname.classList.remove("successfully1");
                            return form_nickname.classList.add("invalid");
                        }
                        else {
                            username.value = response.username;
                            form_nickname.classList.remove("invalid");
                            form_nickname.classList.remove("invalid2");
                            form_nickname.classList.remove("invalid3");
                            form_nickname.classList.remove("successfully1");
                            return form_nickname.classList.add("successfully1");
                        }
                    },
                //   error: function(response) {
                //     console.log('Error:', response);
                //   }
                });
                });
            // if (
            //     !form_nickname.classList.contains("invalid") &&
            //     !form_nickname.classList.contains("invalid2") &&
            //     !form_nickname.classList.contains("invalid3")
            // ) {
            //     form_nickname.classList.remove("invalid");
            //     form_nickname.classList.remove("invalid2");
            //     form_nickname.classList.remove("invalid3");
            //     return true
            // } 
            }}, 500);
            }
            
            initialon();
        }}};

function initialclearTimeout()
{
    clearTimeout(initial);
}
username.addEventListener("keyup", initialclearTimeout);
username.addEventListener("keyup", () => {
    checkUsers();
});
        $(document).ready(function() {
            // add event listener for form submit
            $('#nickname').submit(function(e) {
            e.preventDefault(); // prevent default form submission behavior
        
            // get name input value
            const name = $('#username').val();
        
            // create AJAX request
            $.ajax({
                type: 'POST',
                url: '',
                headers: {
                'X-CSRFToken': '{{ csrf_token }}'
                },
                data: {
                'username': name,
                'username_edit': true
                },
                dataType: 'json',
                success: function(response) {
                    const form_nickname = document.getElementById("form_nickname");
                    const username = document.getElementById("username");
                    if (response.successfully == false){
                        form_nickname.classList.remove("successfully");
                        form_nickname.classList.remove("successfully1");
                        form_nickname.classList.remove("invalid2");
                        form_nickname.classList.remove("invalid3");
                        form_nickname.classList.add("invalid");
                    }
                    else {
                        username.value = response.username;
                        form_nickname.classList.remove("invalid");
                        form_nickname.classList.remove("invalid2");
                        form_nickname.classList.remove("invalid3");
                        form_nickname.classList.remove("successfully1");
                        form_nickname.classList.add("successfully")
                    }
                },
            //   error: function(response) {
            //     console.log('Error:', response);
            //   }
            });
            });

            // add event listener for form submit
            $('#email').submit(function(e) {
            e.preventDefault(); // prevent default form submission behavior
        
            // get email input value
            const email = $('#const_email').val();
            const password = $('#email_password').val();
        
            // create AJAX request
            $.ajax({
                type: 'POST',
                url: '',
                headers: {
                'X-CSRFToken': '{{ csrf_token }}'
                },
                data: {
                'email': email,
                'password': password,
                'email_edit': true
                },
                dataType: 'json',
                success: function(response) {
                },
            //   error: function(response) {
            //     console.log('Error:', response);
            //   }
            });
            });

            // add event listener for form submit
            $('#password').submit(function(e) {
            e.preventDefault(); // prevent default form submission behavior
        
            // get passwords input value
            const old_password = $('#const_password').val();
            const new_password = $('#password_new').val();
            const new_password2 = $('#Cpassword_new').val();
        
            // create AJAX request
            $.ajax({
                type: 'POST',
                url: '',
                headers: {
                'X-CSRFToken': '{{ csrf_token }}'
                },
                data: {
                'old_password': old_password,
                'new_password': new_password,
                'new_password2': new_password2,
                'password_edit': true
                },
                dataType: 'json',
                success: function(response) {
                    if (response.successfully == false){
                        passwordValue.classList.add("invalid");
                    } else{
                        window.location.href = "{% url 'login' %}";
                    }
                },
            //   error: function(response) {
            //     console.log('Error:', response);
            //   }
            });
            });

            // add event listener for form submit
            $('#delete').submit(function(e) {
            e.preventDefault(); // prevent default form submission behavior
        
            // get passwords input value
            const delete_password = $('#delete_password').val();
            // create AJAX request
            $.ajax({
                type: 'POST',
                url: '',
                headers: {
                'X-CSRFToken': '{{ csrf_token }}'
                },
                data: {
                'delete_password': delete_password,
                'delete': true
                },
                dataType: 'json',
                success: function(response) {
                    const delete_invalid = document.getElementById("delete_invalid");
                    if (response.successfully == false){
                        delete_invalid.classList.add("invalid3");
                    } else{
                        window.location.href = "{% url 'home' %}";
                    }

                },
            //   error: function(response) {
            //     console.log('Error:', response);
            //   }
            });
            });
        });
    </script>
</body>
</html>